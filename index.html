<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Project</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js"></script>
</head>

<body>

	<input id="get 1" type="button" value="get first" />
	<input id="get 2" type="button" value="get second" />
	<h2>info 1</h2>
	<div id="info 1"></div>
	<div class="container">
		<canvas id="chart"></canvas>
	</div>
	<h2>info 2</h2>
	<div id="info 2"></div>

	<script type="text/javascript">

		// on development
		let todaysHost = 'http://34.105.76.204';
		// stackoverflow.com/questions/43871637/no-access-control-allow-origin-header-is-present-on-the-requested-resource-whe

		// on deploy
		// fetch('q1')
		// on development
		// fetch(`${proxyurl}/${todaysHost}/q1`)
		// or if cors used ...
		// fetch(`${todaysHost}/q1`)

		var ctx;
		var chart;
		document.getElementById("get 1").onclick = function () {
			fetch(`${todaysHost}/1345`) //fetch('1345')
				.then(response => { return response.json(); })
				.then(data => {
					returnedRows = data.results.rows;
					starttime = [];
					speed = [];
					starttime = returnedRows.map(x => x['starttime']);
					speed = returnedRows.map(x => x['speed']);
					ctx = document.getElementById("chart").getContext("2d");
					chart = new Chart(ctx, {
						type: 'line',
						data: {
							labels: starttime,
							datasets: [{
								label: '1345',
								data: speed,
								borderColor: 'rgba(0, 0, 255, 0.8)',
								backgroundColor: 'rgba(0, 0, 255, 0.3)',
								borderWidth: 1,
								spanGaps: true,
								fill: false,
							}]
						},
						options: {
							scales: {
								xAxes: [{
									type: 'time'
								}]
							}
						}
					});
					return fetch(`${todaysHost}/1346`); //fetch('1346')
				})
				.then(response => { return response.json(); })
				.then(data => {
					returnedRows = data.results.rows;
					speed = [];
					speed = returnedRows.map(x => x['speed']);

					another = {
						label: '1346',
						data: speed,
						borderColor: 'rgba(0, 255, 0, 0.8)',
						backgroundColor: 'rgba(0, 255, 0, 0.3)',
						borderWidth: 1,
						spanGaps: true,
						fill: false,
					}

					chart.data.datasets.push(another);
					chart.update();
				})
				.catch(error => {
					console.log('failed', error)
				})
		}

		document.getElementById("get 2").onclick = function () {
			fetch('q2')
				.then(response => {
					return response.json();
				})
				.then(data => {
					console.log('requested:', data.results.rows);
					document.getElementById("info 2").innerHTML = JSON.stringify(data.results.rows);
				})
				.catch(error => {
					console.log('failed', error)
				});
		}

	</script>
</body>

</html>
