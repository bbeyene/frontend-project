<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Project</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js"></script>
	<script src="https://rawgit.com/moment/moment/2.2.1/min/moment.min.js"></script>
</head>

<body>

	<input id="get 1" type="button" value="get first" />
	<input id="get 2" type="button" value="get second" />
	<h2>info 1</h2>
	<div id="info 1"></div>
	<div class="container">
		<canvas id="chartSpeed"></canvas>
	</div>
	<div class="container">
		<canvas id="chartVolume"></canvas>
	</div>
	<h2>info 2</h2>
	<div id="info 2"></div>

	<script type="text/javascript">

		// on development
		let todaysHost = 'http://34.105.22.120';
		// stackoverflow.com/questions/43871637/no-access-control-allow-origin-header-is-present-on-the-requested-resource-whe

		// on deploy
		// fetch('q1')
		// on development
		// fetch(`${proxyurl}/${todaysHost}/q1`)
		// or if cors used ...
		// fetch(`${todaysHost}/q1`)

		var ctx;
		var chartSpeed;
		document.getElementById("get 1").onclick = function () {
			fetch(`${todaysHost}/1345`) //fetch('1345')
				.then(response => { return response.json(); })
				.then(data => {
					returnedRows = data.results.rows;
					starttime = [];
					speed = [];
					volume = [];
					starttime = returnedRows.map(x => moment.utc((x['starttime'])).format('h:mm a'));
					speed = returnedRows.map(x => x['speed']);

					ctx = document.getElementById("chartSpeed").getContext("2d");
					chartSpeed = new Chart(ctx, {
						type: 'line',
						data: {
							labels: starttime,
							datasets: [{
								label: 'lane 1',
								data: speed,
								borderColor: 'rgba(0, 0, 255, 0.8)',
								backgroundColor: 'rgba(0, 0, 255, 0.3)',
								fill: false,
								showLine: false,
								pointRadius: 1
							}]
						},
						options: {
							animation: {
								duration: 0 
							},
							hover: {
								animationDuration: 0 
							},
							responsiveAnimationDuration: 0,
						},
						defaults: {
							line: {
								showLine: false,
							}
						}
					});
					return fetch(`${todaysHost}/1346`); //fetch('1346')
				})
				.then(response => { return response.json(); })
				.then(data => {
					returnedRows = data.results.rows;
					speed = [];
					speed = returnedRows.map(x => x['speed']);

					another = {
						label: 'lane 2',
						data: speed,
						borderColor: 'rgba(0, 255, 0, 0.8)',
						backgroundColor: 'rgba(0, 255, 0, 0.3)',
						fill: false,
						showLine: false,
						pointRadius: 1
					}

					chartSpeed.data.datasets.push(another);
					chartSpeed.update(0);
					return fetch(`${todaysHost}/1348`); //fetch('1348')
				})
				.then(response => { return response.json(); })
				.then(data => {
					returnedRows = data.results.rows;
					speed = [];
					speed = returnedRows.map(x => x['speed']);

					another = {
						label: 'lane 3',
						data: speed,
						borderColor: 'rgba(255, 0, 0, 0.8)',
						backgroundColor: 'rgba(255, 0, 0, 0.3)',
						fill: false,
						showLine: false,
						pointRadius: 1
					}

					chartSpeed.data.datasets.push(another);
					chartSpeed.update(0);
				})
				.catch(error => {
					console.log('failed', error)
				})
		}

		document.getElementById("get 2").onclick = function () {
			fetch('q2')
				.then(response => {
					return response.json();
				})
				.then(data => {
					console.log('requested:', data.results.rows);
					document.getElementById("info 2").innerHTML = JSON.stringify(data.results.rows);
				})
				.catch(error => {
					console.log('failed', error)
				});
		}

	</script>
</body>

</html>
